# RDB Sync - StarRocks 连接器


## 适用范围
- StarRocks：2.x，3.x


## 来源
暂无支持...😅


## 目标
### 先决条件
1. 用户至少对“目标表”具有 `Insert`、`Update` 和 `Delete` 权限。

### 管道配置
标记 `📌` 表示关键配置，在配置表中具有独立的字段，其余配置以 YAML 格式保存在 `options` 字段中。

| 配置                                | 类型      | 默认值                | 说明                                                                                                                                                                                                                                                                                                                                                     |
|-----------------------------------|---------|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| id `📌`                           | String  | _*必填_              | 管道目标ID                                                                                                                                                                                                                                                                                                                                                 |
| name `📌`                         | String  | _*必填_              | 管道目标名称                                                                                                                                                                                                                                                                                                                                                 |
| protocol `📌`                     | String  | _*必填_              | 管道目标协议，设置为 `starrocks` 以使用此连接器                                                                                                                                                                                                                                                                                                                         |
| hostnames `📌hosts`               | String  | localhost          | FE MySQL 服务主机名列表 <br>使用 `;` 分隔多个主机名。                                                                                                                                                                                                                                                                                                                   |
| ports `📌`                        | String  | 9030               | FE MySQL 服务端口列表 <br>使用 `;` 分隔多个端口。                                                                                                                                                                                                                                                                                                                     |
| jdbc-url                          | String  |                    | FE MySQL 服务的连接字符串 <br>格式类似于 `jdbc:mysql://fe_ip1:query_port,fe_ip2:query_port...` 。 <br>_注意：如果使用了此配置，将会覆盖上面两个“简化”配置。_                                                                                                                                                                                                                                  |
| load-hostnames `📌load_hosts`     | String  | localhost          | FE HTTP 服务主机列表列表 <br>使用 `;` 分隔多个主机名。                                                                                                                                                                                                                                                                                                                   |
| load-ports `📌load_ports`         | String  | 8030               | FE HTTP 服务端口列表 <br>使用 `;` 分隔多个端口。                                                                                                                                                                                                                                                                                                                      |
| load-url                          | String  |                    | FE HTTP 服务的 URL 列表 <br>格式类似于 `fe_ip1:http_port;http://fe_ip2:http_port;https://fe_nlb` ，未指定 URL 前缀时默认为 `http://` ，请多个 URL 之间使用 `;` 分隔。 <br>_注意：如果使用了此配置，将会覆盖上面两个“简化”配置。_                                                                                                                                                                               |
| database-name `📌database`        | String  | _*必填_              | 数据库名                                                                                                                                                                                                                                                                                                                                                   |
| username `📌`                     | String  | root               | 用户名                                                                                                                                                                                                                                                                                                                                                    |
| password `📌`                     | String  |                    | 密码                                                                                                                                                                                                                                                                                                                                                     |
| sink.semantic                     | String  | at-least-once      | 语义保证 <li>`at-least-once`：一个事件至少同步一次；<li>`exactly-once`：一个事件精确同步一次，建议升级 StarRocks 至 2.5 或更高版本后使用。                                                                                                                                                                                                                                                       |
| sink.version                      | String  | AUTO               | 导入数据的接口。 <li>`V1`：使用 [Stream Load](https://docs.starrocks.io/zh/docs/loading/StreamLoad/) 接口导入数据； <li>`V2`：使用 [Stream Load 事务接口](https://docs.starrocks.io/zh/docs/loading/Stream_Load_transaction_interface/)导入数据。要求 StarRocks 版本大于等于 2.4。建议选择 V2，因为其降低内存使用，并提供了更稳定的 exactly-once 实现； <li>`AUTO`：如果 StarRocks 版本支持 Stream Load 事务接口，将自动选择 V2，否则选择 V1。 |
| sink.label-prefix                 | String  |                    | Stream Load 的标签前缀 <br>若语义保证是 `exactly-once` 时，建议设置此值，具体请参考[官方文档](https://docs.starrocks.io/zh/docs/loading/Flink-connector-starrocks/#exactly-once)。                                                                                                                                                                                                   |
| sink.buffer-flush.max-bytes       | Long    | 94371840（90MB）     | 积攒在内存的数据大小，达到该阈值后数据通过 Stream Load 一次性导入 StarRocks。取值范围：[64MB, 10GB]。将此参数设置为较大的值可以提高导入性能，但可能会增加导入延迟。 该参数只在 `sink.semantic` 为 `at-least-once` 才会生效。 `sink.semantic` 为 `exactly-once` ，则只有 Flink checkpoint 触发时 flush 内存的数据，因此该参数不生效。                                                                                                                     |
| sink.buffer-flush.max-rows        | Long    | 500000             | 积攒在内存的数据条数，达到该阈值后数据通过 Stream Load 一次性导入 StarRocks。取值范围：[64000, 5000000]。该参数只在 `sink.version` 为 `V1`，`sink.semantic` 为 `at-least-once` 才会生效。                                                                                                                                                                                                            |
| sink.max-retries                  | Integer | 3                  | Stream Load 失败后的重试次数。超过该数量上限，则数据导入任务报错。取值范围：[0, 10]。该参数只在 `sink.version` 为 `V1` 才会生效。                                                                                                                                                                                                                                                                  |
| sink.connect.timeout-ms           | Integer | 30000              | 与 FE 建立 HTTP 连接的超时时间。取值范围：[100, 60000]。                                                                                                                                                                                                                                                                                                                |
| sink.wait-for-continue.timeout-ms | Integer | 10000              | 等待 FE HTTP 100-continue 应答的超时时间。取值范围：[3000, 60000]。                                                                                                                                                                                                                                                                                                    |
| security.sensitive.keys           | String  | username; password | 安全属性：包含敏感信息的键名列表 <br>在输出日志时，它们的值会被脱敏。使用 `;` 分隔多个键名。                                                                                                                                                                                                                                                                                                    |


## 参考资料
- [从 Apache Flink® 持续导入](https://docs.starrocks.io/zh/docs/loading/Flink-connector-starrocks/) · _StarRocks_
